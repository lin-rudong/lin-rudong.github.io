<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="使用MySQL选择数据库最初连接到MySQL时,没有任何数据库打开供你使用,在执行任意数据库操作前,需要选择一个数据库. 1use d 了解数据库和表1234567891011121314show databasesshow tables-- 等价show columns from tdescribe tshow create database dshow create table tshow g">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL必知必会">
<meta property="og:url" content="https://lin-rudong.github.io/2019/03/20/MySQL必知必会/index.html">
<meta property="og:site_name" content="林如东的博客">
<meta property="og:description" content="使用MySQL选择数据库最初连接到MySQL时,没有任何数据库打开供你使用,在执行任意数据库操作前,需要选择一个数据库. 1use d 了解数据库和表1234567891011121314show databasesshow tables-- 等价show columns from tdescribe tshow create database dshow create table tshow g">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-03-22T08:39:49.617Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MySQL必知必会">
<meta name="twitter:description" content="使用MySQL选择数据库最初连接到MySQL时,没有任何数据库打开供你使用,在执行任意数据库操作前,需要选择一个数据库. 1use d 了解数据库和表1234567891011121314show databasesshow tables-- 等价show columns from tdescribe tshow create database dshow create table tshow g">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://lin-rudong.github.io/2019/03/20/MySQL必知必会/"/>





  <title>MySQL必知必会 | 林如东的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

	<a href="https://github.com/lin-rudong"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
	
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">林如东的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lin-rudong.github.io/2019/03/20/MySQL必知必会/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="林如东">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林如东的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">MySQL必知必会</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-20T21:29:06+08:00">
                2019-03-20
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2019-03-22T16:39:49+08:00">
                2019-03-22
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">MySQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/03/20/MySQL必知必会/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/03/20/MySQL必知必会/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/03/20/MySQL必知必会/" class="leancloud_visitors" data-flag-title="MySQL必知必会">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  8.6k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  31
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="使用MySQL"><a href="#使用MySQL" class="headerlink" title="使用MySQL"></a>使用MySQL</h1><h2 id="选择数据库"><a href="#选择数据库" class="headerlink" title="选择数据库"></a>选择数据库</h2><p>最初连接到MySQL时,没有任何数据库打开供你使用,在执行任意数据库操作前,需要选择一个数据库.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use d</span><br></pre></td></tr></table></figure>
<h2 id="了解数据库和表"><a href="#了解数据库和表" class="headerlink" title="了解数据库和表"></a>了解数据库和表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">show databases</span><br><span class="line">show tables</span><br><span class="line"></span><br><span class="line">-- 等价</span><br><span class="line">show columns from t</span><br><span class="line">describe t</span><br><span class="line"></span><br><span class="line">show create database d</span><br><span class="line">show create table t</span><br><span class="line">show grants</span><br><span class="line"></span><br><span class="line">show status -- 服务器状态信息</span><br><span class="line">show errors</span><br><span class="line">show warnings</span><br></pre></td></tr></table></figure>
<h1 id="检索数据"><a href="#检索数据" class="headerlink" title="检索数据"></a>检索数据</h1><h2 id="检索所有列"><a href="#检索所有列" class="headerlink" title="检索所有列"></a>检索所有列</h2><p>一般,除非你确实需要表中的每个列,否则最好别使用*通配符,因为检索不需要的列通常会降低检索和应用程序的性能.</p>
<h2 id="检索不同的行"><a href="#检索不同的行" class="headerlink" title="检索不同的行"></a>检索不同的行</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select distinct i from t</span><br></pre></td></tr></table></figure>
<p>不能部分使用distinct,distinct关键字应用于所有列.</p>
<h2 id="限制结果"><a href="#限制结果" class="headerlink" title="限制结果"></a>限制结果</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select i from t limit 5 -- 0,1,2,3,4</span><br><span class="line">select i from t limit 5,5 -- 5,6,7,8,9</span><br><span class="line">select i from t limit 4 offset 3 -- limit 3,4</span><br></pre></td></tr></table></figure>
<h1 id="排序检索数据"><a href="#排序检索数据" class="headerlink" title="排序检索数据"></a>排序检索数据</h1><h2 id="排序数据"><a href="#排序数据" class="headerlink" title="排序数据"></a>排序数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select i from t order by i</span><br></pre></td></tr></table></figure>
<p>order by子句中使用的列可以是非检索的列.</p>
<h2 id="按多个列排序"><a href="#按多个列排序" class="headerlink" title="按多个列排序"></a>按多个列排序</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select i,n from t order by i,n</span><br></pre></td></tr></table></figure>
<h2 id="指定排序方向"><a href="#指定排序方向" class="headerlink" title="指定排序方向"></a>指定排序方向</h2><p>默认是升序排序,为了进行降序排序,必须指定desc关键字.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select i from t order by i desc</span><br></pre></td></tr></table></figure>
<p>desc关键字只应用到直接位于其前面的列明,如果想在多个列上进行降序排序,必须对每个列指定desc关键字.</p>
<p>与desc相反的关键字是asc.</p>
<p>order by子句的位置.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select i from t order by i limit 5</span><br></pre></td></tr></table></figure>
<h1 id="过滤数据"><a href="#过滤数据" class="headerlink" title="过滤数据"></a>过滤数据</h1><h2 id="使用where子句"><a href="#使用where子句" class="headerlink" title="使用where子句"></a>使用where子句</h2><p>where子句的位置.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select i from t where i=1 order by i</span><br></pre></td></tr></table></figure>
<h2 id="where子句操作符"><a href="#where子句操作符" class="headerlink" title="where子句操作符"></a>where子句操作符</h2><p>MySQL支持的条件操作符有=,&lt;&gt;,!=,&lt;,&lt;=,&gt;,&gt;=,between.</p>
<h3 id="检查单个值"><a href="#检查单个值" class="headerlink" title="检查单个值"></a>检查单个值</h3><p>MySQL在执行匹配时默认不区分大小写.</p>
<h3 id="范围值检查"><a href="#范围值检查" class="headerlink" title="范围值检查"></a>范围值检查</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select i from t where i between 5 and 10</span><br></pre></td></tr></table></figure>
<p>between匹配范围中所有的值,包括指定的开始值和结束值.</p>
<h3 id="空值检查"><a href="#空值检查" class="headerlink" title="空值检查"></a>空值检查</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select i from t where i is null</span><br></pre></td></tr></table></figure>
<h1 id="数据过滤"><a href="#数据过滤" class="headerlink" title="数据过滤"></a>数据过滤</h1><h2 id="组合where子句"><a href="#组合where子句" class="headerlink" title="组合where子句"></a>组合where子句</h2><h3 id="and操作符"><a href="#and操作符" class="headerlink" title="and操作符"></a>and操作符</h3><h3 id="or操作符"><a href="#or操作符" class="headerlink" title="or操作符"></a>or操作符</h3><h3 id="计算次序"><a href="#计算次序" class="headerlink" title="计算次序"></a>计算次序</h3><p>任何时候使用具有and和or操作符的where子句,都应该使用圆括号明确地分组操作符.</p>
<h2 id="in操作符"><a href="#in操作符" class="headerlink" title="in操作符"></a>in操作符</h2><p>in操作符优点具体如下.</p>
<ol>
<li>in操作符一般比or操作符清单执行更快.</li>
<li>in的最大优点是可以包含其他select语句,使得能够更动态地建立where子句.</li>
</ol>
<p>功能与or相当.</p>
<h2 id="not操作符"><a href="#not操作符" class="headerlink" title="not操作符"></a>not操作符</h2><h1 id="用通配符进行过滤"><a href="#用通配符进行过滤" class="headerlink" title="用通配符进行过滤"></a>用通配符进行过滤</h1><h2 id="like操作符"><a href="#like操作符" class="headerlink" title="like操作符"></a>like操作符</h2><h3 id="百分号-通配符"><a href="#百分号-通配符" class="headerlink" title="百分号(%)通配符"></a>百分号(%)通配符</h3><p>%表时任何字符出现任意次数.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select i from t where i like &apos;zi%&apos;</span><br></pre></td></tr></table></figure>
<p>%除了一个或多个字符外,还能匹配0个字符.</p>
<p>%不能匹配null.</p>
<h3 id="下划线-通配符"><a href="#下划线-通配符" class="headerlink" title="下划线(_)通配符"></a>下划线(_)通配符</h3><p>_只匹配单个字符,不能多也不能少.</p>
<h2 id="使用通配符的技巧"><a href="#使用通配符的技巧" class="headerlink" title="使用通配符的技巧"></a>使用通配符的技巧</h2><p>除非绝对有必要,否则不要把它们用在搜索模式的开始处,这样搜索起来是最慢的.</p>
<h1 id="用正则表达式进行搜索"><a href="#用正则表达式进行搜索" class="headerlink" title="用正则表达式进行搜索"></a>用正则表达式进行搜索</h1><h2 id="使用MySQL正则表达式"><a href="#使用MySQL正则表达式" class="headerlink" title="使用MySQL正则表达式"></a>使用MySQL正则表达式</h2><h3 id="基本字符匹配"><a href="#基本字符匹配" class="headerlink" title="基本字符匹配"></a>基本字符匹配</h3><p><code>.</code>表示匹配任意一个字符.</p>
<p>regexp关键字,其与like有一个重要的差别,like匹配整个列,而regexp在列值内进行匹配,如果regexp要和like一样,需要使用^和$定位符.</p>
<p>匹配不区分大小写,为区分大小写,可使用regexp binary.</p>
<h3 id="进行or匹配"><a href="#进行or匹配" class="headerlink" title="进行or匹配"></a>进行or匹配</h3><p><code>|</code>为正则表达式的or操作.</p>
<h3 id="匹配几个字符之一"><a href="#匹配几个字符之一" class="headerlink" title="匹配几个字符之一"></a>匹配几个字符之一</h3><p><code>[]</code>匹配任何指定的单一字符,[]是另一种形式的or语句.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select i from t where i regexp &apos;[123]&apos;</span><br></pre></td></tr></table></figure>
<p>字符集合也可以被否定,在集合的开始处防止一个^即可.</p>
<h3 id="匹配范围"><a href="#匹配范围" class="headerlink" title="匹配范围"></a>匹配范围</h3><p>集合可使用<code>-</code>来定义一个范围.</p>
<h3 id="匹配特殊字符"><a href="#匹配特殊字符" class="headerlink" title="匹配特殊字符"></a>匹配特殊字符</h3><p>为了匹配特殊字符,必须用<code>\\</code>转义.</p>
<p>空白元字符包括,<code>\\f</code>换页,<code>\\n</code>换行,<code>\\r</code>回车,<code>\\t</code>制表,<code>\\v</code>纵向制表.</p>
<p>为了匹配反斜杠字符本身,需要使用<code>\\\</code>.</p>
<p>MySQL要求两个反斜杠,MySQL自己解释一个,正则表达式库解释另一个.</p>
<h3 id="匹配多个实例"><a href="#匹配多个实例" class="headerlink" title="匹配多个实例"></a>匹配多个实例</h3><p>重复元字符.</p>
<ol>
<li><code>*</code>匹配0个或多个匹配,等于{0,}.</li>
<li><code>+</code>1个或多个匹配,等于{1,}.</li>
<li><code>?</code>0个或1个匹配,等于{0,1}.</li>
<li><code>{n}</code>指定数目的匹配.</li>
<li><code>{n,}</code>不少于指定数目的匹配.</li>
<li><code>{n,m}</code>匹配数目的范围,m不超过255.</li>
</ol>
<h3 id="定位符"><a href="#定位符" class="headerlink" title="定位符"></a>定位符</h3><ol>
<li><code>^</code>文本的开始.</li>
<li><code>$</code>文本的结尾.</li>
<li><code>[[:&lt;:]]</code>词的开始.</li>
<li><code>[[:&gt;:]]</code>词的结尾.</li>
</ol>
<p>简单的正则表达式测试,0表示没有匹配,1表示匹配.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &apos;hello&apos; regexp &apos;h.&apos;</span><br></pre></td></tr></table></figure>
<h1 id="创建计算字段"><a href="#创建计算字段" class="headerlink" title="创建计算字段"></a>创建计算字段</h1><h2 id="计算字段"><a href="#计算字段" class="headerlink" title="计算字段"></a>计算字段</h2><p>计算字段是运行时在select语句中创建的.</p>
<h2 id="拼接字段"><a href="#拼接字段" class="headerlink" title="拼接字段"></a>拼接字段</h2><p>多数DBMS使用+或||来实现拼接,MySQL则使用<code>concat()</code>函数来实现.</p>
<p>别名用<code>as</code>关键字赋予,别名有时也称为导出列.</p>
<h2 id="执行算数计算"><a href="#执行算数计算" class="headerlink" title="执行算数计算"></a>执行算数计算</h2><p>支持的基本算数操作符,<code>+</code>,<code>-</code>,<code>*</code>,<code>/</code>.</p>
<p>select提供了测试和试验函数与计算的一个很好的办法.</p>
<h1 id="使用数据处理函数"><a href="#使用数据处理函数" class="headerlink" title="使用数据处理函数"></a>使用数据处理函数</h1><h2 id="使用函数"><a href="#使用函数" class="headerlink" title="使用函数"></a>使用函数</h2><ol>
<li>文本函数.</li>
<li>数值函数.</li>
<li>日期和时间函数.</li>
<li>系统函数.</li>
</ol>
<h3 id="文本处理函数"><a href="#文本处理函数" class="headerlink" title="文本处理函数"></a>文本处理函数</h3><ol>
<li><code>left()</code>返回串左边的字符.</li>
<li><code>right()</code>返回串右边的字符.</li>
<li><code>length()</code>返回串的长度.</li>
<li><code>locate()</code>找出串的一个字串.</li>
<li><code>substring()</code>返回字串的字符.</li>
<li><code>soundex()</code>返回串的soundex值,soundex是一个和发音相关的值.</li>
<li><code>lower()</code>将串转换为小写.</li>
<li><code>upper()</code>将串转换为大写.</li>
<li><code>ltrim()</code>去掉串左边的空格.</li>
<li><code>rtrim()</code>去掉串右边的空格.</li>
<li><code>trim()</code>去点串两边的空格.</li>
</ol>
<h3 id="日期和时间处理函数"><a href="#日期和时间处理函数" class="headerlink" title="日期和时间处理函数"></a>日期和时间处理函数</h3><ol>
<li><code>now()</code>返回当前日期和时间.</li>
<li><code>curdate()</code>返回当前日期.</li>
<li><code>curtime()</code>返回当前时间.</li>
<li><code>date()</code>返回日期时间的日期部分.</li>
<li><code>time()</code>返回日期时间的时间部分.</li>
<li><code>day()</code>返回日期的天数部分.</li>
<li><code>month()</code>返回日期的月份部分.</li>
<li><code>year()</code>返回日期的年份部分.</li>
<li><code>dayofweek()</code>返回日期对应的星期.</li>
<li><code>hour()</code>返回时间的小时部分.</li>
<li><code>minute()</code>返回时间的分钟部分.</li>
<li><code>second()</code>返回时间的秒部分.</li>
<li><code>adddate()</code>增加一个日期,date_add()同义.</li>
<li><code>addtime()</code>增加一个时间.</li>
<li><code>datediff()</code>计算两个日期之差.</li>
<li><code>date_format</code>返回一个格式化的日期或时间串.</li>
</ol>
<h3 id="数值处理函数"><a href="#数值处理函数" class="headerlink" title="数值处理函数"></a>数值处理函数</h3><ol>
<li><code>abs()</code>绝对值.</li>
<li><code>mod()</code>除操作的余数.</li>
<li><code>rand()</code>随机数.</li>
<li><code>sqrt()</code>开方根.</li>
<li><code>pow()</code>指数值.</li>
<li><code>pi()</code>圆周率.</li>
<li><code>exp()</code>e的指数值.</li>
<li><code>cos()</code>余弦.</li>
<li><code>sin()</code>正弦.</li>
<li><code>tan()</code>正切.</li>
</ol>
<h1 id="汇总数据"><a href="#汇总数据" class="headerlink" title="汇总数据"></a>汇总数据</h1><h2 id="聚集函数"><a href="#聚集函数" class="headerlink" title="聚集函数"></a>聚集函数</h2><p>聚集函数运行在行组上,计算和返回单个值的函数.</p>
<ol>
<li><code>avg()</code>列的平均值.</li>
<li><code>count()</code>列的行数.</li>
<li><code>max()</code>列的最大值.</li>
<li><code>min()</code>列的最小值.</li>
<li><code>sum()</code>列值之和.</li>
</ol>
<p>都会忽略值为null的行,除了count(*)的用法.</p>
<h2 id="聚集不同值"><a href="#聚集不同值" class="headerlink" title="聚集不同值"></a>聚集不同值</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select avg(distinct i) from t</span><br></pre></td></tr></table></figure>
<p>distinct必须使用列名,不能用于count(*),用于min()和max()没有意义.</p>
<h1 id="分组数据"><a href="#分组数据" class="headerlink" title="分组数据"></a>分组数据</h1><h2 id="创建分组"><a href="#创建分组" class="headerlink" title="创建分组"></a>创建分组</h2><ol>
<li>group by子句可以包含任意数目的列,为数据分组提供更细致的控制.</li>
<li>所有null值将作为一个分组返回.</li>
<li>group by子句必须出现在where子句之后,order by子句之前.</li>
</ol>
<p>使用with rollup关键字,可以得到每个分组以及每个分组汇总级别的值.</p>
<h2 id="过滤分组"><a href="#过滤分组" class="headerlink" title="过滤分组"></a>过滤分组</h2><p>where过滤行,having过滤分组.</p>
<p>where在数据分组前进行过滤,having在数据分组后进行过滤,where排除的行不包括在分组中.</p>
<h2 id="select子句顺序"><a href="#select子句顺序" class="headerlink" title="select子句顺序"></a>select子句顺序</h2><ol>
<li>select.</li>
<li>from.</li>
<li>where.</li>
<li>group.</li>
<li>having.</li>
<li>order by.</li>
<li>limit.</li>
</ol>
<h1 id="使用子查询"><a href="#使用子查询" class="headerlink" title="使用子查询"></a>使用子查询</h1><h2 id="利用子查询进行过滤"><a href="#利用子查询进行过滤" class="headerlink" title="利用子查询进行过滤"></a>利用子查询进行过滤</h2><p>子查询一般与in操作符结合使用,但也还可以和条件操作符结合.</p>
<h2 id="作为计算字段使用子查询"><a href="#作为计算字段使用子查询" class="headerlink" title="作为计算字段使用子查询"></a>作为计算字段使用子查询</h2><h1 id="联结表"><a href="#联结表" class="headerlink" title="联结表"></a>联结表</h1><h2 id="创建联结"><a href="#创建联结" class="headerlink" title="创建联结"></a>创建联结</h2><h3 id="where子句的重要性"><a href="#where子句的重要性" class="headerlink" title="where子句的重要性"></a>where子句的重要性</h3><p>select语句中联结几个表时,相应的关系是在运行中构造的,在数据库表的定义中不存在能指示MySQL如何联结的东西.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select t.i as ti,u.i as ui </span><br><span class="line">from t,u</span><br><span class="line">where...</span><br></pre></td></tr></table></figure>
<p>在from子句中联结的结果是笛卡尔积,检索出的行的数目将是第一个表中的行数乘以第二个表中的行数.</p>
<h3 id="内部联结"><a href="#内部联结" class="headerlink" title="内部联结"></a>内部联结</h3><p>from子句的联结默认是内部联结,也称为等值联结.</p>
<p>用inner join和on关键字比较规范,传递给on的实际条件与传递给where的相同,都是过滤作用.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select t.i as ti,u.i as ui </span><br><span class="line">from t inner join u</span><br><span class="line">on...</span><br></pre></td></tr></table></figure>
<h1 id="创建高级联结"><a href="#创建高级联结" class="headerlink" title="创建高级联结"></a>创建高级联结</h1><h2 id="使用不同类型的联结"><a href="#使用不同类型的联结" class="headerlink" title="使用不同类型的联结"></a>使用不同类型的联结</h2><h3 id="自联结"><a href="#自联结" class="headerlink" title="自联结"></a>自联结</h3><p>用自联结而不用子查询,虽然最终的结果是相同的,但有时候处理联结远比处理子查询快得多.</p>
<h3 id="外部联结"><a href="#外部联结" class="headerlink" title="外部联结"></a>外部联结</h3><p>联结包含了那些在相关表中没有关联行的行,这种类型的联结称为外部联结.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select t.i as ti,u.i as ui</span><br><span class="line">from t left outer join u</span><br><span class="line">on t.i=u.i</span><br></pre></td></tr></table></figure>
<p>必须使用right或left关键字指定包括其所有行的表.</p>
<h1 id="组合查询"><a href="#组合查询" class="headerlink" title="组合查询"></a>组合查询</h1><h2 id="组合查询-1"><a href="#组合查询-1" class="headerlink" title="组合查询"></a>组合查询</h2><p>有两种基本情况,需要使用组合查询.</p>
<ol>
<li>在单个查询中从不同的表返回类似结构的数据.</li>
<li>对单个表执行多个查询,按单个查询返回数据.</li>
</ol>
<p>组合相同表的两个查询与具有多个where子句条件的单条查询完成的工作相同,这两种技术在不同的查询中性能也不同.</p>
<h2 id="创建组合查询"><a href="#创建组合查询" class="headerlink" title="创建组合查询"></a>创建组合查询</h2><p>可用union操作符来组合数条查询,将它们的结果组合成单个结果集.</p>
<h3 id="union规则"><a href="#union规则" class="headerlink" title="union规则"></a>union规则</h3><ol>
<li>union中的每个查询必须包含相同的列,表达式或聚集函数,不过各个列不需要以相同的次序列出.</li>
<li>列数据类型必须兼容.</li>
</ol>
<h3 id="包含或取消重复的行"><a href="#包含或取消重复的行" class="headerlink" title="包含或取消重复的行"></a>包含或取消重复的行</h3><p>union从查询结果集中自动去除了重复的行,换句话说,它的行为与单条select语句中使用多个where子句条件一样,这是union的默认行为,如果想要返回所有匹配的行,可使用union all.</p>
<h3 id="对组合查询结果排序"><a href="#对组合查询结果排序" class="headerlink" title="对组合查询结果排序"></a>对组合查询结果排序</h3><p>在用union组合查询时,只能使用一条order by子句,它必须出现在最后一条select语句之后.</p>
<h1 id="全文本搜索"><a href="#全文本搜索" class="headerlink" title="全文本搜索"></a>全文本搜索</h1><p>通配符和正则表达式的几个重要的限制.</p>
<ol>
<li>性能,通配符和正则表达式匹配通常要求MySQL尝试匹配表中所有行,而且这些搜索极少使用表索引,因此,由于被搜索行数不断增加,这些搜索可能非常耗时.</li>
<li>明确控制,很难明确地控制匹配什么和不匹配什么.</li>
<li>智能化的结果,虽然这些搜素提供了非常灵活的搜索,但它们都不能提供一种智能化的选择结果的方法,例如按照可能是更好的匹配来排列它们,类似,一个特殊词的搜索将不会找出不包含该词但包含其他相关词的行.</li>
</ol>
<p>在使用全文本搜索时,MySQL不需要分别查看每个行,不需要分别分析和处理每个词,MySQL创建指定列中各词的一个索引,搜索可以针对这些词进行,这样,MySQL可以快速有效地决定哪些词匹配,哪些词不匹配,它们匹配的频率等等.</p>
<h2 id="使用全文本搜索"><a href="#使用全文本搜索" class="headerlink" title="使用全文本搜索"></a>使用全文本搜索</h2><p>为了进行全文本搜索,必须索引被搜索的列,在索引之后,select可与match()和against()一起使用以实际执行搜索.</p>
<h3 id="启用全文本搜索支持"><a href="#启用全文本搜索支持" class="headerlink" title="启用全文本搜索支持"></a>启用全文本搜索支持</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table t(</span><br><span class="line">	id int not null auto_increment,</span><br><span class="line">	t text null,</span><br><span class="line">	primary key(id),</span><br><span class="line">	fulltext(t)</span><br><span class="line">)engine=MyISAM</span><br></pre></td></tr></table></figure>
<p>在定义之后,MySQL自动维护该索引,在增加,更新或删除行时,索引随之自动更新.</p>
<p>不要在导入数据时使用fulltext,更新索引要花时间,应该首先导入所有数据,然后再修改表,定义fulltext.</p>
<h3 id="进行全文本搜索"><a href="#进行全文本搜索" class="headerlink" title="进行全文本搜索"></a>进行全文本搜索</h3><p>在索引之后,使用两个函数match()和against()执行全文本搜索,其中match()指定被搜索的列,against()指定要使用的搜索表达式.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select t from t</span><br><span class="line">where match(t) against(&apos;lin&apos;)</span><br></pre></td></tr></table></figure>
<p>除非使用binary方式,否则全文本搜索不区分大小写.</p>
<p>全文本搜索的一个重要部分就是对结果排序,具有较高等级的行先返回.</p>
<p>全文本搜索提供了简单like搜索不能提供的功能,而且由于数据是索引的,全文本能搜索还相当快.</p>
<h3 id="使用查询扩展"><a href="#使用查询扩展" class="headerlink" title="使用查询扩展"></a>使用查询扩展</h3><p>利用查询扩展,能找出可能相关的记过,即使它们并不精确包含所查找的词.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select t from t</span><br><span class="line">where match(t) against(&apos;lin&apos; with query expansion)</span><br></pre></td></tr></table></figure>
<p>MySQL对数据和索引进行两边扫描来完成搜索.</p>
<ol>
<li>首先,进行一个基本的全文本搜索,找出与搜索条件匹配的所有行.</li>
<li>其次,MySQL检查这些匹配行并选择所有有用的词.</li>
<li>再其次,MySQL再次进行全文本搜索,这次不仅使用原来的条件,而且还使用所有有用的词.</li>
</ol>
<h3 id="布尔文本搜索"><a href="#布尔文本搜索" class="headerlink" title="布尔文本搜索"></a>布尔文本搜索</h3><ol>
<li>要匹配的词.</li>
<li>要排斥的词.</li>
<li>排列提示,指定某些词比其他词更重要.</li>
<li>表达式分组.</li>
<li>另外一些内容.</li>
</ol>
<p>布尔方式即使没有fulltext索引也可以使用,但这时一种非常缓慢的操作,其性能将随着数据量的增加而降低.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select t from t</span><br><span class="line">where match(t) against(&apos;lin -hello*&apos; in boolean mode)</span><br></pre></td></tr></table></figure>
<p><code>-hello*</code>排除以hello开始的词.</p>
<p>全文本布尔操作符.</p>
<ol>
<li><code>+</code>包含,词必须存在.</li>
<li><code>-</code>排除,词必须不出现.</li>
<li><code>&gt;</code>包含,而且增加等级值.</li>
<li><code>&lt;</code>包含,且减少等级值.</li>
<li><code>()</code>把此组成子表达式,允许这些子表达式作为一个组被包含,排除,排列等.</li>
<li><code>~</code>取消一个词的排序值.</li>
<li><code>*</code>词尾的通配符.</li>
<li><code>&quot;&quot;</code>定义一个短语,与单个词的列表不一样,它匹配整个短语以便包含或排除这个短语.</li>
</ol>
<h3 id="全文本搜索的使用说明"><a href="#全文本搜索的使用说明" class="headerlink" title="全文本搜索的使用说明"></a>全文本搜索的使用说明</h3><ol>
<li>短词被忽略且从索引中排除,短语默认为3个或3个以下字符的词.</li>
<li>MySQL带有一个内建的非用词列表.</li>
<li>许多次出现的频率很高,搜索它们没有用处,返回太多的结果,因此,MySQL规定了一条50%规则,如果一个词出现在50%以上的行中,则将它作为一个非用词忽略,50%规则不用于in boolean mode.</li>
<li>如果表中的行数少于3行,则全文本搜索不返回结果,因为每个词或者不出现,或者至少出现在50%的行中.</li>
<li>忽略词中的单引号.</li>
<li>不具有词分歌词的语言不能恰当地返回全文本搜索结果.</li>
<li>仅在MyISAM数据库引擎中支持全文本搜索.</li>
</ol>
<h1 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h1><h2 id="插入完整的行"><a href="#插入完整的行" class="headerlink" title="插入完整的行"></a>插入完整的行</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t(i) values(1)</span><br></pre></td></tr></table></figure>
<p>省略列,该列定义为默认值,或者null值.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert low_priority into</span><br></pre></td></tr></table></figure>
<p>降低优先级.</p>
<h2 id="插入多个行"><a href="#插入多个行" class="headerlink" title="插入多个行"></a>插入多个行</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t(i) values(1),(2)</span><br></pre></td></tr></table></figure>
<p>可以提高数据库处理的性能,因为MySQL用单条insert语句处理多个插入比使用多条insert语句快.</p>
<h2 id="插入检索出的数据"><a href="#插入检索出的数据" class="headerlink" title="插入检索出的数据"></a>插入检索出的数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t(i) select i from t</span><br></pre></td></tr></table></figure>
<h1 id="更新和删除数据"><a href="#更新和删除数据" class="headerlink" title="更新和删除数据"></a>更新和删除数据</h1><h2 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update t set i=i+1,n=n+1 where i=1</span><br></pre></td></tr></table></figure>
<p>在update语句中可以使用子查询,使得能用select语句检索出的数据更新列数据.</p>
<p>如果用update语句更新多行,并且在更新这些行中的一行或多行时出现一个错误,则整个update操作被取消,为即使是发生错误,也继续进行更新,可使用ignore关键字.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update ignore t...</span><br></pre></td></tr></table></figure>
<p>如果允许null值,删除某个列的值,可设置它为null.</p>
<h2 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from t where i=1</span><br></pre></td></tr></table></figure>
<p>delete删除表的内容而不是表.</p>
<p>如果想从表中删除所有行,不要使用delete,可使用truncate table语句,它完成相同的工作,但速度更快,truncate实际是删除原来的表并重新创建一个表,而不是逐行删除表中的数据.</p>
<h1 id="创建和操纵表"><a href="#创建和操纵表" class="headerlink" title="创建和操纵表"></a>创建和操纵表</h1><h2 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h2><h3 id="表创建基础"><a href="#表创建基础" class="headerlink" title="表创建基础"></a>表创建基础</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table t(</span><br><span class="line">	i int not null auto_increment,</span><br><span class="line">    n int not null default 1,</span><br><span class="line">	primary key(i)</span><br><span class="line">)engine=InnoDB</span><br></pre></td></tr></table></figure>
<p>如果仅想在一个表不存在时创建它,应该在表名后给出if not exists,它只是查看表名是否存在,并且仅在表名不存在时创建它.</p>
<h3 id="主键再介绍"><a href="#主键再介绍" class="headerlink" title="主键再介绍"></a>主键再介绍</h3><p>主键必须唯一非空.</p>
<h3 id="使用auto-increment"><a href="#使用auto-increment" class="headerlink" title="使用auto_increment"></a>使用auto_increment</h3><p>每个表只允许一个auto_increment列,而且它必须被索引,通常使它成为主键.</p>
<p>用last_insert_id()函数返回最后一个auto_increment值.</p>
<h3 id="指定默认值"><a href="#指定默认值" class="headerlink" title="指定默认值"></a>指定默认值</h3><p>MySQL不允许使用函数作为默认值,它只支持常量.</p>
<p>使用默认值而不是null值,特别是对用于计算或数据分组的列更是如此.</p>
<h3 id="引擎类型"><a href="#引擎类型" class="headerlink" title="引擎类型"></a>引擎类型</h3><ol>
<li>InnoDB是一个可靠的事务处理引擎,它不支持全文本搜索.</li>
<li>MEMORY在功能等同于MyISAM,但由于数据存储在内存而不是磁盘,速度很快,特别适合于临时表.</li>
<li>MyISAM是一个性能极高的引擎,它支持全文本搜索,但不支持事务处理.</li>
</ol>
<p>引擎类型可以混用,不同的表可以用不同的引擎.</p>
<p>外键不能跨引擎.</p>
<h2 id="更新表"><a href="#更新表" class="headerlink" title="更新表"></a>更新表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">alter table t add n int</span><br><span class="line">alter table t drop column n</span><br><span class="line"></span><br><span class="line">alter table t </span><br><span class="line">add constraint fk </span><br><span class="line">foreign key(fi) references f(i)</span><br></pre></td></tr></table></figure>
<h2 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table t</span><br></pre></td></tr></table></figure>
<h2 id="重命名表"><a href="#重命名表" class="headerlink" title="重命名表"></a>重命名表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename table t to t1</span><br></pre></td></tr></table></figure>
<h1 id="使用视图"><a href="#使用视图" class="headerlink" title="使用视图"></a>使用视图</h1><h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><h3 id="为什么使用视图"><a href="#为什么使用视图" class="headerlink" title="为什么使用视图"></a>为什么使用视图</h3><ol>
<li>重用SQL语句.</li>
<li>简化复杂的SQL操作,在编写查询后,可以方便地重用它而不必知道它的基本查询细节.</li>
<li>使用表的组成部分而不是整个表.</li>
<li>保护数据.</li>
<li>更改数据格式和表示.</li>
</ol>
<p>因为视图不包含数据,所以每次使用视图时,都必须处理查询执行时所需的任一个检索,如果你用多个联结和过滤创建了复杂的视图或者嵌套了视图,可能会发现性能下降得很厉害,因此,在部署使用了大量视图的应用前,应该进行测试.</p>
<h3 id="视图的规则和限制"><a href="#视图的规则和限制" class="headerlink" title="视图的规则和限制"></a>视图的规则和限制</h3><ol>
<li>与表一样,视图必须唯一命名,不能给视图取与别的视图或表相同的名字.</li>
<li>对于可以创建的视图数目没有限制.</li>
<li>为了创建视图,必须具有足够的访问权限.</li>
<li>视图可以嵌套,即可以利用从其他视图中检索数据的查询来构造一个视图.</li>
<li>order by可以用在视图中,但如果从该视图检索数据select中也含有order by,那么该视图中的order by将被覆盖.</li>
<li>视图不能索引,也不能有关联的触发器或默认值.</li>
<li>视图可以和表一起使用.</li>
</ol>
<h2 id="使用视图-1"><a href="#使用视图-1" class="headerlink" title="使用视图"></a>使用视图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create view v</span><br><span class="line">show create view v</span><br><span class="line">drop view v</span><br><span class="line">create or replace view v</span><br></pre></td></tr></table></figure>
<h3 id="利用视图简化复杂的联结"><a href="#利用视图简化复杂的联结" class="headerlink" title="利用视图简化复杂的联结"></a>利用视图简化复杂的联结</h3><p>创建可重用的视图.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create view v as</span><br><span class="line">select i from t</span><br><span class="line">where i in (1,2,3)</span><br></pre></td></tr></table></figure>
<h3 id="更新视图"><a href="#更新视图" class="headerlink" title="更新视图"></a>更新视图</h3><p>视图是可更新的,更新一个视图将更新其基表.</p>
<p>并非所有视图都是可更新的,基本上可以说,如果MySQL不能正确地确定被更新的基数据,则不允许更新,如果视图定义中有以下操作,则不能进行视图的更新.</p>
<ol>
<li>分组.</li>
<li>联结.</li>
<li>子查询.</li>
<li>并.</li>
<li>聚集函数.</li>
<li>distinct.</li>
<li>导出计算列.</li>
</ol>
<p>视图主要用于数据检索.</p>
<h1 id="使用存储过程"><a href="#使用存储过程" class="headerlink" title="使用存储过程"></a>使用存储过程</h1><h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><p>存储过程简单来说,就是为以后的使用而保存的一条或多条MySQL语句的集合.</p>
<h2 id="为什么要使用存储过程"><a href="#为什么要使用存储过程" class="headerlink" title="为什么要使用存储过程"></a>为什么要使用存储过程</h2><ol>
<li>通过把处理封装在容易使用的单元中,简化复杂的操作.</li>
<li>由于不要求反复建立一系列处理步骤,这保证了数据的完整性,如果所有开发人员和应用程序都是用统一存储过程,则所使用的代码都是相同的,这一点的延伸就是防止错误,需要执行的步骤越多,出错的可能性就越大,防止错误保证了数据的一致性.</li>
<li>简化对变动的管理,如果表名,列名或业务逻辑有变化,只需要更改存储过程的代码,使用它的人员甚至不需要知道这些变化,这一点的延伸就是安全性,通过存储过程限制对基础数据的访问减少了数据讹误的机会.</li>
<li>提高性能,因为使用存储过程比使用单独的SQL语句要快.</li>
<li>存在一些只能用在单个请求中的MySQL元素和特性,存储过程可以使用它们来编写功能更强更灵活的代码.</li>
</ol>
<p>换句话说,使用存储过程有3个主要的好处,即简单,安全,高性能,不过,存储过程也有它的一些缺陷.</p>
<ol>
<li>一般来说,存储过程的编写比基本SQL语句复杂,编写存储过程需要更高的技能,更丰富的经验.</li>
<li>你可能没有创建存储过程的安全访问权限.</li>
</ol>
<h2 id="使用存储过程-1"><a href="#使用存储过程-1" class="headerlink" title="使用存储过程"></a>使用存储过程</h2><h3 id="执行存储过程"><a href="#执行存储过程" class="headerlink" title="执行存储过程"></a>执行存储过程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call p()</span><br></pre></td></tr></table></figure>
<h3 id="创建存储过程"><a href="#创建存储过程" class="headerlink" title="创建存储过程"></a>创建存储过程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create procedure p()</span><br><span class="line">begin</span><br><span class="line">	select i from t</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h3 id="删除存储过程"><a href="#删除存储过程" class="headerlink" title="删除存储过程"></a>删除存储过程</h3><p>存储过程在创建之后,被保存在服务器上以供使用,直至被删除.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">drop procedure p</span><br><span class="line">drop procedure if exists p</span><br></pre></td></tr></table></figure>
<h3 id="使用参数"><a href="#使用参数" class="headerlink" title="使用参数"></a>使用参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create procedure p(</span><br><span class="line">    out a decimal(8,2)</span><br><span class="line">)</span><br><span class="line">begin</span><br><span class="line">	select min(i) into a from t</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>关键字out指出相应的参数用来从存储过程传出一个值,返回给调用者,MySQL支持in,传递给存储过程,out从存储过程传出和inout对存储过程传入和传出,检索值用into保存到相应的变量.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">call p(@result)</span><br><span class="line"></span><br><span class="line">select @result</span><br></pre></td></tr></table></figure>
<p>所有MySQL变量都必须以@开始.</p>
<p>select可以显示结果.</p>
<h3 id="建立智能存储过程"><a href="#建立智能存储过程" class="headerlink" title="建立智能存储过程"></a>建立智能存储过程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create procedure p(</span><br><span class="line">	in c boolean</span><br><span class="line">)comment &apos;this is a procedure&apos;</span><br><span class="line">begin</span><br><span class="line">	declare a decimal(8,2)</span><br><span class="line">	declare b int default 1</span><br><span class="line"></span><br><span class="line">	if c then</span><br><span class="line">		...</span><br><span class="line">	end if</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>declare语句定义局部变量,要求指定变量名和数据类型,它也支持可选的默认值.</p>
<p>comment值可以用show procedure status显示.</p>
<p>if语句还支持elseif和else子句,elseif还是用then子句,else不使用.</p>
<h3 id="检查存储过程"><a href="#检查存储过程" class="headerlink" title="检查存储过程"></a>检查存储过程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show create procedure p</span><br><span class="line">show procedure status like &apos;f&apos;</span><br></pre></td></tr></table></figure>
<h1 id="使用游标"><a href="#使用游标" class="headerlink" title="使用游标"></a>使用游标</h1><h2 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h2><p>MySQL检索操作返回一组称为结果集的行,有时,需要在检索出来的行中前进或后退一行或多汗给,这就是是使用游标的原因,游标是语句检索出来的结果集,应用程序可以根据需要滚动或浏览其中的数据.</p>
<p>游标主要用于交互式应用,其中用户需要滚动屏幕上的数据,并对数据进行浏览或做出更改.</p>
<p>不像多数DBMS,MySQL游标只能用于存储过程.</p>
<h2 id="使用游标-1"><a href="#使用游标-1" class="headerlink" title="使用游标"></a>使用游标</h2><ol>
<li>在能够使用游标前,必须声明定义它,这个过程实际上没有检索数据,只是定义要使用的select语句.</li>
<li>一旦声明后,必须打开游标以供使用,这个过程用前面定义的select语句把数据实际检索出来.</li>
<li>对于填有数据的游标,根据需要取出检索各行.</li>
<li>在结束游标使用时,必须关闭游标.</li>
</ol>
<h3 id="创建游标"><a href="#创建游标" class="headerlink" title="创建游标"></a>创建游标</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create procedure p()</span><br><span class="line">begin</span><br><span class="line">	declare c cursor</span><br><span class="line">	for</span><br><span class="line">	select i from t</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h3 id="打开和关闭游标"><a href="#打开和关闭游标" class="headerlink" title="打开和关闭游标"></a>打开和关闭游标</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">open c</span><br><span class="line">close c</span><br></pre></td></tr></table></figure>
<p>游标关闭后,如果没有重新打开,则不能使用它,但是生命过的游标不需要再次声明,用open语句打开它就可以了.</p>
<p>如果你不明确关闭游标,MySQL将会在到达end语句时自动关闭它.</p>
<h3 id="使用游标数据"><a href="#使用游标数据" class="headerlink" title="使用游标数据"></a>使用游标数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">create procedure p()</span><br><span class="line">begin</span><br><span class="line">	declare o int</span><br><span class="line">	declare done boolean default 0</span><br><span class="line"></span><br><span class="line">	declare c cursor</span><br><span class="line">	for</span><br><span class="line">	select i from t</span><br><span class="line">	</span><br><span class="line">	declare continue handler</span><br><span class="line">	for sqlstate &apos;02000&apos; </span><br><span class="line">	set done=1</span><br><span class="line">	</span><br><span class="line">	open c</span><br><span class="line">	</span><br><span class="line">	repeat </span><br><span class="line">		fetch c into o</span><br><span class="line">	until done end repeat</span><br><span class="line">	</span><br><span class="line">	close c</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>continue handler在条件出现时被执行,sqlstate ‘02000’是一个未找到条件,当游标没有更多的行时出现这个条件.</p>
<p>除repeat语句外,MySQL还支持循环语句,直到使用leave语句手动退出位置,通常repeat语句的语法使它更适合于对游标进行循环.</p>
<h1 id="使用触发器"><a href="#使用触发器" class="headerlink" title="使用触发器"></a>使用触发器</h1><h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p>触发器是MySQL响应delete,insert和update语句而自动执行的一条MySQL语句,或位于begin和end语句之间的一组语句.</p>
<h2 id="创建触发器"><a href="#创建触发器" class="headerlink" title="创建触发器"></a>创建触发器</h2><ol>
<li>唯一的触发器名.</li>
<li>触发器关联的表.</li>
<li>触发器应该响应的活动.</li>
<li>触发器何时执行,处理之前或之后.</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create trigger tr after insert on t</span><br><span class="line">for each row</span><br><span class="line">insert into u values(&apos;added&apos;)</span><br></pre></td></tr></table></figure>
<p>for each row指定了对每个插入行执行一次.</p>
<p>只有表才支持触发器,视图不支持,临时表也不支持.</p>
<p>每个表最多支持6个触发器,每条insert,update,delete的之前和之后,单一触发器不能与多个时间或多个表关联.</p>
<p>如果before触发器失败,则MySQL将不执行请求的操作,此外,如果before触发器或语句本身失败,MySQL将不执行after触发器.</p>
<h2 id="删除触发器"><a href="#删除触发器" class="headerlink" title="删除触发器"></a>删除触发器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop trigger tr</span><br></pre></td></tr></table></figure>
<p>触发器不能更新或覆盖.</p>
<h2 id="使用触发器-1"><a href="#使用触发器-1" class="headerlink" title="使用触发器"></a>使用触发器</h2><h3 id="insert触发器"><a href="#insert触发器" class="headerlink" title="insert触发器"></a>insert触发器</h3><ol>
<li>insert触发器代码内,可引用一个名位new的虚拟表,访问被插入的行.</li>
<li>在before insert触发器中,new中的值也可以本更新,允许更改被插入的值.</li>
<li>对于auto_increment列,new在insert执行之前包含0,在insert执行之后包含新的自动生成值.</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create trigger tr after insert on t</span><br><span class="line">for each row</span><br><span class="line">insert into u values(new.i)</span><br></pre></td></tr></table></figure>
<p>通常,将before用于数据验证和净化,也适用于update触发器.</p>
<h3 id="delete触发器"><a href="#delete触发器" class="headerlink" title="delete触发器"></a>delete触发器</h3><ol>
<li>在delete触发器代码内,可以引用一个名为old的虚拟表,访问被删除的行.</li>
<li>old中的值全部都是只读的,不能更新.</li>
</ol>
<h3 id="update触发器"><a href="#update触发器" class="headerlink" title="update触发器"></a>update触发器</h3><ol>
<li>在update触发器代码中,可以引用一个名为old的虚拟表访问以前的值,引用一个名为new的虚拟表访问新更新的值.</li>
<li>在before update触发器中,new中的值可能也被更新,允许更改将要用于update语句中的值.</li>
<li>old中的值全部是只读的,不能更新.</li>
</ol>
<h3 id="关于触发器的进一步介绍"><a href="#关于触发器的进一步介绍" class="headerlink" title="关于触发器的进一步介绍"></a>关于触发器的进一步介绍</h3><ol>
<li>应该用触发器来保证数据的一致性(大小写,格式等),在触发器中执行这种类型的处理的优点是它总是进行这种处理,而且是透明地进行,与客户机应用无关.</li>
<li>触发器的一种非常有意义的使用是创建审计跟踪,把更改记录到另一个表非常容易.</li>
</ol>
<h1 id="管理事务处理"><a href="#管理事务处理" class="headerlink" title="管理事务处理"></a>管理事务处理</h1><h2 id="事务处理"><a href="#事务处理" class="headerlink" title="事务处理"></a>事务处理</h2><ol>
<li>事务指一组SQL语句.</li>
<li>回退指撤销指定SQL语句的过程.</li>
<li>提交指将未存储的SQL语句结果写入数据库表.</li>
<li>保留点指事务处理中设置的临时占位符,你可以对它发布回退.</li>
</ol>
<h2 id="控制事务处理"><a href="#控制事务处理" class="headerlink" title="控制事务处理"></a>控制事务处理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start transaction</span><br></pre></td></tr></table></figure>
<h3 id="使用rollback"><a href="#使用rollback" class="headerlink" title="使用rollback"></a>使用rollback</h3><p>rollback只能在一个事务处理内使用,在执行一条start transaction命令之后.事务处理用来管理insert,update和delete语句,你不能回退其他语句.</p>
<h3 id="使用commit"><a href="#使用commit" class="headerlink" title="使用commit"></a>使用commit</h3><h3 id="使用保留点"><a href="#使用保留点" class="headerlink" title="使用保留点"></a>使用保留点</h3><p>为了支持回退部分事务处理,必须能在事务处理块中合适的位置放置占位符.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">savepoint s</span><br><span class="line"></span><br><span class="line">rollback to s</span><br></pre></td></tr></table></figure>
<p>保留点越多越好,你就越能按自己的意愿灵活地进行回退.</p>
<p>保留点在事务处理完成(执行一条rollback或commit)后自动释放,也可以用release savepoint明确地释放保留点.</p>
<h3 id="更改默认的提交行为"><a href="#更改默认的提交行为" class="headerlink" title="更改默认的提交行为"></a>更改默认的提交行为</h3><p>默认的MySQL行为是自动提交所有更改,换句话说,任何时候你执行一条MySQL语句,该语句实际上都是针对表执行的,而且所做的更改立即生效,为指示MySQL不自动提交更改,需要使用以下语句.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set autocommit=1</span><br></pre></td></tr></table></figure>
<p>autocommit标识是针对每个连接而不是服务器的.</p>
<h1 id="全球化和本地化"><a href="#全球化和本地化" class="headerlink" title="全球化和本地化"></a>全球化和本地化</h1><h2 id="字符集和校对顺序"><a href="#字符集和校对顺序" class="headerlink" title="字符集和校对顺序"></a>字符集和校对顺序</h2><ol>
<li>字符集为字母和符号的集合.</li>
<li>编码为某个字符集成员的内部表示.</li>
<li>校对为规定字符如何比较的指令. </li>
</ol>
<p>使用字符集和校对的决定在服务器,数据库和表级进行.</p>
<h2 id="使用字符集和校对顺序"><a href="#使用字符集和校对顺序" class="headerlink" title="使用字符集和校对顺序"></a>使用字符集和校对顺序</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show character set</span><br><span class="line"></span><br><span class="line">show collation</span><br></pre></td></tr></table></figure>
<p>有的字符集具有不止一种校对,而且许多校对出现两次,一次区分大小写,由_cs表示,一次不区分大小写,由_ci表示.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show variables like &apos;character%&apos;</span><br><span class="line"></span><br><span class="line">show variables like &apos;collation%</span><br></pre></td></tr></table></figure>
<p>实际上,字符集很少是服务器范围,甚至数据库范围的设置,不同的表,甚至不同的列都可能需要不同的字符集,而且两者都可以在创建表时指定.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table t(</span><br><span class="line">	i int character set latin1 </span><br><span class="line">    	collate latin1_general_ci,</span><br><span class="line">    n int</span><br><span class="line">)default character set hebrew</span><br><span class="line">collate hebrew_general_ci</span><br></pre></td></tr></table></figure>
<p>校对在对用order by子句检索出来的数据排序时起重要的作用,如果需要用与创建表时不同的校对顺序排序特定的select语句.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from t</span><br><span class="line">order by i collate latin1_general_cs</span><br></pre></td></tr></table></figure>
<p>collate还可以用与group by,having,聚集函数,别名等.</p>
<h1 id="安全管理"><a href="#安全管理" class="headerlink" title="安全管理"></a>安全管理</h1><h2 id="管理用户"><a href="#管理用户" class="headerlink" title="管理用户"></a>管理用户</h2><p>用户账号和信息存储在名为mysql的数据库中,一般不需要直接访问mysql数据库和表,但有时需要直接访问,需要直接访问它的时机之一是在需要获得所有用户账号列表时.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use mysql</span><br><span class="line">select user from user</span><br></pre></td></tr></table></figure>
<h3 id="创建用户账号"><a href="#创建用户账号" class="headerlink" title="创建用户账号"></a>创建用户账号</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create user u identified by &apos;p@$$w0rd&apos;</span><br><span class="line"></span><br><span class="line">rename user u to u1</span><br></pre></td></tr></table></figure>
<h3 id="删除用户账号"><a href="#删除用户账号" class="headerlink" title="删除用户账号"></a>删除用户账号</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop user u</span><br></pre></td></tr></table></figure>
<h3 id="设置访问权限"><a href="#设置访问权限" class="headerlink" title="设置访问权限"></a>设置访问权限</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show grants for u@%</span><br></pre></td></tr></table></figure>
<p>用户定义为user@host,MySQL的权限用用户名和主机名结合定义,如果不指定主机名,则使用默认的主机名%(授予用户访问权限而不管主机名).</p>
<p>usage表时没有权限.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grant select on db.* to u</span><br><span class="line"></span><br><span class="line">revoke select on db.* from u</span><br></pre></td></tr></table></figure>
<p>grant和revoke可在几个层次上控制访问权限.</p>
<ol>
<li>整个服务器,使用grant all和revoke all.</li>
<li>整个数据库,使用on db.*.</li>
<li>特定的表,使用on db.t.</li>
<li>特定的列.</li>
<li>特定的存储过程.</li>
</ol>
<p>使用grant和revoke时,用户账号必须存在,但对所涉及的对象没有这个要求,当某个数据库或表被删除时,相关的访问权限仍然存在.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grant select,insert on db.* to u</span><br></pre></td></tr></table></figure>
<h3 id="更改口令"><a href="#更改口令" class="headerlink" title="更改口令"></a>更改口令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set password for u=password(&apos;p@$$w0rd&apos;)</span><br><span class="line"></span><br><span class="line">-- 当前登陆用户</span><br><span class="line">set password=password(&apos;p@$$w0rd&apos;)</span><br></pre></td></tr></table></figure>
<h1 id="数据库维护"><a href="#数据库维护" class="headerlink" title="数据库维护"></a>数据库维护</h1><p>MySQL数据库是基于磁盘的文件,普通的备份系统和例程就能备份MySQL的而数据,但是,由于这些文件总是处于打开和使用状态,普通的文件副本备份不一定总是有效.</p>
<ol>
<li>使用命令行使用程序mysqldump转储所有数据库内容到某个外部文件,在进行常规备份前这个使用程序应该正常运行,以便能正确地备份转储文件.</li>
<li>可用命令行使用程序mysqlhotcopy从一个数据库复制所有数据,并非所有数据库引擎都支持这个实用程序.</li>
<li>可以使用MySQL的back table或select into outfile转储所有数据到某个外部文件,这两条语句都接受将要创建的系统文件名,数据可以用restore table来复原.</li>
</ol>
<p>首先刷新未写数据,为了保证所有数据被写到磁盘(包括索引数据),可能需要在进行备份前使用flush tables语句.</p>
<h2 id="进行数据库维护"><a href="#进行数据库维护" class="headerlink" title="进行数据库维护"></a>进行数据库维护</h2><ol>
<li>analyze table用来检查表键是否正确.</li>
<li>check table用来针对许多问题对表进行检查,在MyISAM表上还对索引进行检查.</li>
<li>如果MyISAM表访问产生不正确和不一致的结果,可能需要用repair table来修复相应的表,这条语句不应该经常使用,如果需要经常使用,可能会有更大的问题要解决.</li>
<li>如果从一个表中删除大量数据,应该使用optimize table来收回所用的空间,从而优化表的性能.</li>
</ol>
<h2 id="诊断启动问题"><a href="#诊断启动问题" class="headerlink" title="诊断启动问题"></a>诊断启动问题</h2><p>通过在命令行上手动执行mysqld启动.</p>
<h2 id="查看日志文件"><a href="#查看日志文件" class="headerlink" title="查看日志文件"></a>查看日志文件</h2><ol>
<li>错误日志,它包含启动和关闭问题以及任意关键错误的细节,日志通常名为hostname.err,位于data目录中.</li>
<li>查询日志,它记录所有MySQL活动,在诊断问题时非常有用,此日志文件可能会很快变得非常大,因此不应该长期使用它,此日志通常名为hostname.log.</li>
<li>二进制日志,它记录更新过数据或者可能更新过数据的所有语句,此日志通常名为hostname-bin.</li>
<li>缓慢查询日志,此日志记录执行缓慢的任何查询,此日志通常名为hostname-slow.log.</li>
</ol>
<h1 id="改善性能"><a href="#改善性能" class="headerlink" title="改善性能"></a>改善性能</h1><ol>
<li>总是有不止一种方法编写同一条select语句,应该试验联结,并,子查询等,找出最佳的方法.</li>
<li>使用explain语句让MySQL解释它讲如何执行一条select语句.</li>
<li>一般来说,存储过程执行得比一条一条地执行其中得各条MySQL语句快.</li>
<li>有的操作(包括insert)支持一个可选的delayed关键字,如果使用它,将把控制立即返回给调用程序,并且一旦有可能就实际执行该操作.</li>
<li>在导入数据时,应该关闭自动提交,你可能还想删除索引(包括fulltext索引),然后在导入完成后再重建它们.</li>
<li>如果一个简单的where子句返回结果所花的时间太长,则可以断定其中使用的列或几个列就是需要索引的对象.</li>
<li>通过使用多条select语句和联结它们的union语句代替一系列复杂的or条件,可以看到极大的性能改进.</li>
<li>索引改善数据检索的性能,但损害数据插入,删除和更新的性能.</li>
<li>like很慢,一般来说,最好是使用fulltex而不是like.</li>
</ol>
<h1 id="MySQL数据类型"><a href="#MySQL数据类型" class="headerlink" title="MySQL数据类型"></a>MySQL数据类型</h1><h2 id="串数据类型"><a href="#串数据类型" class="headerlink" title="串数据类型"></a>串数据类型</h2><ol>
<li>char.</li>
<li>varchar.</li>
<li>tinytext.</li>
<li>mediumtext.</li>
<li>text.</li>
<li>longtext.</li>
<li>enum.</li>
<li>set.</li>
</ol>
<h2 id="数值数据类型"><a href="#数值数据类型" class="headerlink" title="数值数据类型"></a>数值数据类型</h2><ol>
<li>float.</li>
<li>double.</li>
<li>tinyint.</li>
<li>smallint.</li>
<li>mediumint.</li>
<li>int.</li>
<li>bigint.</li>
<li>decimal.</li>
<li>boolean.</li>
<li>bit.</li>
<li>real.</li>
</ol>
<h2 id="日期和时间数据类型"><a href="#日期和时间数据类型" class="headerlink" title="日期和时间数据类型"></a>日期和时间数据类型</h2><ol>
<li>date.</li>
<li>time.</li>
<li>year.</li>
<li>timestamp.</li>
<li>datetime.</li>
</ol>
<h2 id="二进制数据类型"><a href="#二进制数据类型" class="headerlink" title="二进制数据类型"></a>二进制数据类型</h2><ol>
<li>tinyblob.</li>
<li>blob.</li>
<li>mediumblob.</li>
<li>longblob.</li>
</ol>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/11/29/Python基础教程/" rel="next" title="Python基础教程">
                <i class="fa fa-chevron-left"></i> Python基础教程
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="林如东" />
            
              <p class="site-author-name" itemprop="name">林如东</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#使用MySQL"><span class="nav-number">1.</span> <span class="nav-text">使用MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#选择数据库"><span class="nav-number">1.1.</span> <span class="nav-text">选择数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#了解数据库和表"><span class="nav-number">1.2.</span> <span class="nav-text">了解数据库和表</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#检索数据"><span class="nav-number">2.</span> <span class="nav-text">检索数据</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#检索所有列"><span class="nav-number">2.1.</span> <span class="nav-text">检索所有列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#检索不同的行"><span class="nav-number">2.2.</span> <span class="nav-text">检索不同的行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#限制结果"><span class="nav-number">2.3.</span> <span class="nav-text">限制结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#排序检索数据"><span class="nav-number">3.</span> <span class="nav-text">排序检索数据</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#排序数据"><span class="nav-number">3.1.</span> <span class="nav-text">排序数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#按多个列排序"><span class="nav-number">3.2.</span> <span class="nav-text">按多个列排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指定排序方向"><span class="nav-number">3.3.</span> <span class="nav-text">指定排序方向</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#过滤数据"><span class="nav-number">4.</span> <span class="nav-text">过滤数据</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用where子句"><span class="nav-number">4.1.</span> <span class="nav-text">使用where子句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#where子句操作符"><span class="nav-number">4.2.</span> <span class="nav-text">where子句操作符</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#检查单个值"><span class="nav-number">4.2.1.</span> <span class="nav-text">检查单个值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#范围值检查"><span class="nav-number">4.2.2.</span> <span class="nav-text">范围值检查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#空值检查"><span class="nav-number">4.2.3.</span> <span class="nav-text">空值检查</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据过滤"><span class="nav-number">5.</span> <span class="nav-text">数据过滤</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#组合where子句"><span class="nav-number">5.1.</span> <span class="nav-text">组合where子句</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#and操作符"><span class="nav-number">5.1.1.</span> <span class="nav-text">and操作符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#or操作符"><span class="nav-number">5.1.2.</span> <span class="nav-text">or操作符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#计算次序"><span class="nav-number">5.1.3.</span> <span class="nav-text">计算次序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#in操作符"><span class="nav-number">5.2.</span> <span class="nav-text">in操作符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#not操作符"><span class="nav-number">5.3.</span> <span class="nav-text">not操作符</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#用通配符进行过滤"><span class="nav-number">6.</span> <span class="nav-text">用通配符进行过滤</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#like操作符"><span class="nav-number">6.1.</span> <span class="nav-text">like操作符</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#百分号-通配符"><span class="nav-number">6.1.1.</span> <span class="nav-text">百分号(%)通配符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#下划线-通配符"><span class="nav-number">6.1.2.</span> <span class="nav-text">下划线(_)通配符</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用通配符的技巧"><span class="nav-number">6.2.</span> <span class="nav-text">使用通配符的技巧</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#用正则表达式进行搜索"><span class="nav-number">7.</span> <span class="nav-text">用正则表达式进行搜索</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用MySQL正则表达式"><span class="nav-number">7.1.</span> <span class="nav-text">使用MySQL正则表达式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本字符匹配"><span class="nav-number">7.1.1.</span> <span class="nav-text">基本字符匹配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进行or匹配"><span class="nav-number">7.1.2.</span> <span class="nav-text">进行or匹配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#匹配几个字符之一"><span class="nav-number">7.1.3.</span> <span class="nav-text">匹配几个字符之一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#匹配范围"><span class="nav-number">7.1.4.</span> <span class="nav-text">匹配范围</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#匹配特殊字符"><span class="nav-number">7.1.5.</span> <span class="nav-text">匹配特殊字符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#匹配多个实例"><span class="nav-number">7.1.6.</span> <span class="nav-text">匹配多个实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定位符"><span class="nav-number">7.1.7.</span> <span class="nav-text">定位符</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建计算字段"><span class="nav-number">8.</span> <span class="nav-text">创建计算字段</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#计算字段"><span class="nav-number">8.1.</span> <span class="nav-text">计算字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#拼接字段"><span class="nav-number">8.2.</span> <span class="nav-text">拼接字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#执行算数计算"><span class="nav-number">8.3.</span> <span class="nav-text">执行算数计算</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用数据处理函数"><span class="nav-number">9.</span> <span class="nav-text">使用数据处理函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用函数"><span class="nav-number">9.1.</span> <span class="nav-text">使用函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#文本处理函数"><span class="nav-number">9.1.1.</span> <span class="nav-text">文本处理函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#日期和时间处理函数"><span class="nav-number">9.1.2.</span> <span class="nav-text">日期和时间处理函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数值处理函数"><span class="nav-number">9.1.3.</span> <span class="nav-text">数值处理函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#汇总数据"><span class="nav-number">10.</span> <span class="nav-text">汇总数据</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#聚集函数"><span class="nav-number">10.1.</span> <span class="nav-text">聚集函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#聚集不同值"><span class="nav-number">10.2.</span> <span class="nav-text">聚集不同值</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#分组数据"><span class="nav-number">11.</span> <span class="nav-text">分组数据</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建分组"><span class="nav-number">11.1.</span> <span class="nav-text">创建分组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#过滤分组"><span class="nav-number">11.2.</span> <span class="nav-text">过滤分组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#select子句顺序"><span class="nav-number">11.3.</span> <span class="nav-text">select子句顺序</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用子查询"><span class="nav-number">12.</span> <span class="nav-text">使用子查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#利用子查询进行过滤"><span class="nav-number">12.1.</span> <span class="nav-text">利用子查询进行过滤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#作为计算字段使用子查询"><span class="nav-number">12.2.</span> <span class="nav-text">作为计算字段使用子查询</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#联结表"><span class="nav-number">13.</span> <span class="nav-text">联结表</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建联结"><span class="nav-number">13.1.</span> <span class="nav-text">创建联结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#where子句的重要性"><span class="nav-number">13.1.1.</span> <span class="nav-text">where子句的重要性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内部联结"><span class="nav-number">13.1.2.</span> <span class="nav-text">内部联结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建高级联结"><span class="nav-number">14.</span> <span class="nav-text">创建高级联结</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用不同类型的联结"><span class="nav-number">14.1.</span> <span class="nav-text">使用不同类型的联结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#自联结"><span class="nav-number">14.1.1.</span> <span class="nav-text">自联结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#外部联结"><span class="nav-number">14.1.2.</span> <span class="nav-text">外部联结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#组合查询"><span class="nav-number">15.</span> <span class="nav-text">组合查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#组合查询-1"><span class="nav-number">15.1.</span> <span class="nav-text">组合查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建组合查询"><span class="nav-number">15.2.</span> <span class="nav-text">创建组合查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#union规则"><span class="nav-number">15.2.1.</span> <span class="nav-text">union规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#包含或取消重复的行"><span class="nav-number">15.2.2.</span> <span class="nav-text">包含或取消重复的行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#对组合查询结果排序"><span class="nav-number">15.2.3.</span> <span class="nav-text">对组合查询结果排序</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#全文本搜索"><span class="nav-number">16.</span> <span class="nav-text">全文本搜索</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用全文本搜索"><span class="nav-number">16.1.</span> <span class="nav-text">使用全文本搜索</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#启用全文本搜索支持"><span class="nav-number">16.1.1.</span> <span class="nav-text">启用全文本搜索支持</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进行全文本搜索"><span class="nav-number">16.1.2.</span> <span class="nav-text">进行全文本搜索</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用查询扩展"><span class="nav-number">16.1.3.</span> <span class="nav-text">使用查询扩展</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#布尔文本搜索"><span class="nav-number">16.1.4.</span> <span class="nav-text">布尔文本搜索</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#全文本搜索的使用说明"><span class="nav-number">16.1.5.</span> <span class="nav-text">全文本搜索的使用说明</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#插入数据"><span class="nav-number">17.</span> <span class="nav-text">插入数据</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#插入完整的行"><span class="nav-number">17.1.</span> <span class="nav-text">插入完整的行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#插入多个行"><span class="nav-number">17.2.</span> <span class="nav-text">插入多个行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#插入检索出的数据"><span class="nav-number">17.3.</span> <span class="nav-text">插入检索出的数据</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#更新和删除数据"><span class="nav-number">18.</span> <span class="nav-text">更新和删除数据</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#更新数据"><span class="nav-number">18.1.</span> <span class="nav-text">更新数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除数据"><span class="nav-number">18.2.</span> <span class="nav-text">删除数据</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建和操纵表"><span class="nav-number">19.</span> <span class="nav-text">创建和操纵表</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建表"><span class="nav-number">19.1.</span> <span class="nav-text">创建表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#表创建基础"><span class="nav-number">19.1.1.</span> <span class="nav-text">表创建基础</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#主键再介绍"><span class="nav-number">19.1.2.</span> <span class="nav-text">主键再介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用auto-increment"><span class="nav-number">19.1.3.</span> <span class="nav-text">使用auto_increment</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#指定默认值"><span class="nav-number">19.1.4.</span> <span class="nav-text">指定默认值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#引擎类型"><span class="nav-number">19.1.5.</span> <span class="nav-text">引擎类型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更新表"><span class="nav-number">19.2.</span> <span class="nav-text">更新表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除表"><span class="nav-number">19.3.</span> <span class="nav-text">删除表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重命名表"><span class="nav-number">19.4.</span> <span class="nav-text">重命名表</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用视图"><span class="nav-number">20.</span> <span class="nav-text">使用视图</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#视图"><span class="nav-number">20.1.</span> <span class="nav-text">视图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#为什么使用视图"><span class="nav-number">20.1.1.</span> <span class="nav-text">为什么使用视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#视图的规则和限制"><span class="nav-number">20.1.2.</span> <span class="nav-text">视图的规则和限制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用视图-1"><span class="nav-number">20.2.</span> <span class="nav-text">使用视图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#利用视图简化复杂的联结"><span class="nav-number">20.2.1.</span> <span class="nav-text">利用视图简化复杂的联结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更新视图"><span class="nav-number">20.2.2.</span> <span class="nav-text">更新视图</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用存储过程"><span class="nav-number">21.</span> <span class="nav-text">使用存储过程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#存储过程"><span class="nav-number">21.1.</span> <span class="nav-text">存储过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#为什么要使用存储过程"><span class="nav-number">21.2.</span> <span class="nav-text">为什么要使用存储过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用存储过程-1"><span class="nav-number">21.3.</span> <span class="nav-text">使用存储过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#执行存储过程"><span class="nav-number">21.3.1.</span> <span class="nav-text">执行存储过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建存储过程"><span class="nav-number">21.3.2.</span> <span class="nav-text">创建存储过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除存储过程"><span class="nav-number">21.3.3.</span> <span class="nav-text">删除存储过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用参数"><span class="nav-number">21.3.4.</span> <span class="nav-text">使用参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#建立智能存储过程"><span class="nav-number">21.3.5.</span> <span class="nav-text">建立智能存储过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#检查存储过程"><span class="nav-number">21.3.6.</span> <span class="nav-text">检查存储过程</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用游标"><span class="nav-number">22.</span> <span class="nav-text">使用游标</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#游标"><span class="nav-number">22.1.</span> <span class="nav-text">游标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用游标-1"><span class="nav-number">22.2.</span> <span class="nav-text">使用游标</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建游标"><span class="nav-number">22.2.1.</span> <span class="nav-text">创建游标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#打开和关闭游标"><span class="nav-number">22.2.2.</span> <span class="nav-text">打开和关闭游标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用游标数据"><span class="nav-number">22.2.3.</span> <span class="nav-text">使用游标数据</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用触发器"><span class="nav-number">23.</span> <span class="nav-text">使用触发器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#触发器"><span class="nav-number">23.1.</span> <span class="nav-text">触发器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建触发器"><span class="nav-number">23.2.</span> <span class="nav-text">创建触发器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除触发器"><span class="nav-number">23.3.</span> <span class="nav-text">删除触发器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用触发器-1"><span class="nav-number">23.4.</span> <span class="nav-text">使用触发器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#insert触发器"><span class="nav-number">23.4.1.</span> <span class="nav-text">insert触发器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#delete触发器"><span class="nav-number">23.4.2.</span> <span class="nav-text">delete触发器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#update触发器"><span class="nav-number">23.4.3.</span> <span class="nav-text">update触发器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关于触发器的进一步介绍"><span class="nav-number">23.4.4.</span> <span class="nav-text">关于触发器的进一步介绍</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#管理事务处理"><span class="nav-number">24.</span> <span class="nav-text">管理事务处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#事务处理"><span class="nav-number">24.1.</span> <span class="nav-text">事务处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#控制事务处理"><span class="nav-number">24.2.</span> <span class="nav-text">控制事务处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用rollback"><span class="nav-number">24.2.1.</span> <span class="nav-text">使用rollback</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用commit"><span class="nav-number">24.2.2.</span> <span class="nav-text">使用commit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用保留点"><span class="nav-number">24.2.3.</span> <span class="nav-text">使用保留点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更改默认的提交行为"><span class="nav-number">24.2.4.</span> <span class="nav-text">更改默认的提交行为</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#全球化和本地化"><span class="nav-number">25.</span> <span class="nav-text">全球化和本地化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#字符集和校对顺序"><span class="nav-number">25.1.</span> <span class="nav-text">字符集和校对顺序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用字符集和校对顺序"><span class="nav-number">25.2.</span> <span class="nav-text">使用字符集和校对顺序</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安全管理"><span class="nav-number">26.</span> <span class="nav-text">安全管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#管理用户"><span class="nav-number">26.1.</span> <span class="nav-text">管理用户</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建用户账号"><span class="nav-number">26.1.1.</span> <span class="nav-text">创建用户账号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除用户账号"><span class="nav-number">26.1.2.</span> <span class="nav-text">删除用户账号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置访问权限"><span class="nav-number">26.1.3.</span> <span class="nav-text">设置访问权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更改口令"><span class="nav-number">26.1.4.</span> <span class="nav-text">更改口令</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据库维护"><span class="nav-number">27.</span> <span class="nav-text">数据库维护</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#进行数据库维护"><span class="nav-number">27.1.</span> <span class="nav-text">进行数据库维护</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#诊断启动问题"><span class="nav-number">27.2.</span> <span class="nav-text">诊断启动问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看日志文件"><span class="nav-number">27.3.</span> <span class="nav-text">查看日志文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#改善性能"><span class="nav-number">28.</span> <span class="nav-text">改善性能</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL数据类型"><span class="nav-number">29.</span> <span class="nav-text">MySQL数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#串数据类型"><span class="nav-number">29.1.</span> <span class="nav-text">串数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数值数据类型"><span class="nav-number">29.2.</span> <span class="nav-text">数值数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#日期和时间数据类型"><span class="nav-number">29.3.</span> <span class="nav-text">日期和时间数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二进制数据类型"><span class="nav-number">29.4.</span> <span class="nav-text">二进制数据类型</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">林如东</span>
  
  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">68.8k</span>
  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'c9wFYOoWTAFtuFlsNOgHNOvF-gzGzoHsz',
        appKey: '617qvdhmqDgNYl9CgBTnce1u',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("c9wFYOoWTAFtuFlsNOgHNOvF-gzGzoHsz", "617qvdhmqDgNYl9CgBTnce1u");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
