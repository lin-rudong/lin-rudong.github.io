---
title: Python基础教程
date: 2018-11-29 16:47:57
tags:
categories: Python
---

# 快速上手：基础知识

## 数和表达式
1. `/`，除法；`//`，整除，向下取整；`%`，取模，整除的余数；`*`，乘法；`**`，乘方/求幂。
1. `0x`，十六进制；`0o`，八进制；`0b`，二进制。

## 函数
1. `round`，内置函数，取最接近的整数，并在两个整数一样近时取偶数。
1. 可以使用变量来引用函数。

## 模块
1. import module，导入模块；from module import function，导入函数。

## 字符串
1. 单引号和双引号作用相同，都是用来表示字符串，可以用反斜杠`\`对引号进行转义，表示其他意义。
1. repr，获得Python表达式的唯一字符串表示。
1. 普通字符串能包含的不可见字符只有空格，其他的不可见字符必须转义，防止混淆。
1. 长字符串，三个引号，可以包含换行符。
1. 原始字符串，前缀r，不对\转义，由于引号用来表示字符串，所以引号仍需转义，\如果在引号前面，除了自身作为字符串的一部分，还会转义引号。
1. \也可以用于Python表达式换行。
1. Unicode编码表示，\u加上字符的16或32位的16进制表示，如果字符有Unicode名称的话，也可以用\N{名称}表示。
1. bytes类型，前缀b，bytes字面量只支持ASCII标准的128个字符，而剩下的128个值必须用转义序列表示，\x加上16进制。
1. bytearray，bytes的可变版。
1. 源代码也将被编码，默认使用的是UTF-8编码，可以用特殊的注释来制定其他编码。

```Python
# -*- coding: ascii -*-
```

# 列表和元组

## 序列概述
1. 常用的3种序列：列表、元组、字符串。
1. 列表是可以修改的，而元组和字符串不可以。
1. 主要的容器：序列、映射、集合。

## 通用的序列操作
1. 索引，-1表示最后一个元素。
1. 切片，第二个索引的位置在第一个索引的左边表示空序列，省略表示切片结束于末尾，第三个值表示步长。
1. 序列相加，表示拼接。
1. 乘法，表示多个序列相加，None表示没有值。
1. 成员资格，使用运算符in判断，字符串还可以进行字串判断。

## 列表：Python的主力
1. 列表的栈操作：append和pop。
1. 队列用模块collections中的deque。

# 使用字符串

## 设置字符串的格式：精简版
1. 旧的字符串格式化方法，%运算符。
1. 新的字符串格式化方法，format方法，如果变量和替换变量同名，可以用前缀f简写。

## 设置字符串的格式：完整版
1. 双花括号可以转义花括号。
1. {字段名（索引或标识符及其操作结果）!转换标志:格式说明符}。
1. 转换标志，s是普通字符串，r是字符串的Python表示，a是字符串的Unicode表示。
1. 格式说明符。
    * 填充字符、=（表示填充字符在符号和数字之间即左右对齐）<>^对齐、-+空格整数前缀、#进制前缀。
    * 宽度、精度、千位分隔符，如果加上f，表示小数精度，否则表示全部精度。
    * 处理类型，转换成其他类型处理。

## 字符串方法
1. Python的类方法和实例方法本质是一样的。

# 当索引行不通时
1. 字典是Pthon中唯一的内置映射类型，键可能是数、字符串或元组。

## 创建和使用字典
1. 赋值可以实现增、改。
1. 键的类型可以是任何不可变类型。 
1. 深复制可以用模块copy中的函数deepcopy实现。
1. 索引不存在的键时会出错，get则会返回None。
1. 字典元素的排列顺序是不确定的。

# 条件、循环及其他语句 

## 赋值魔法
1. 逗号会自动生成元组。
1. 序列解包，*会收集零或多个值到列表。

## 条件和条件语句
1. 任何值都可用作布尔值，Python会自动转换。
1. True和1等同，False和0等同。
1. ==，相等对象；is，相同对象；is not，不同对象。
1. not in，不包含成员。
1. 不兼容的类型不能进行运算。
1. 链式比较。
1. assert运算符，断言，程序在错误条件出现时立即崩溃。

## 循环
1. while循环。
1. for循环，只要能够使用for循环，就不要使用while循环。
1. 遍历字典时，实际上是遍历字典的关键字。
1. zip，将两个序列组成一个元组序列，实现并行迭代。
1. enumerate，将索引和序列组成一个元组序列，实现迭代时获取索引。
1. 循环的else子句，循环没有调用break时执行。

## 简单推导
1. 列表推导，[表达式映射结果 for语句映射源（多个for语句是笛卡尔积） if语句过滤]。
1. 元组不能推导，结果会创建生成器。
1. 字典推导。

## 三人行
1. pass运算符表示空块。
1. del运算符会删除引用变量，而对象是由Python解释器作为垃圾回收的。
1. exec会将字符串作为代码执行，可以动态地编写代码。
1. eval和exec类似，区别在于必须返回计算结果。

# 抽象

## 自定义函数
1. 放在函数体开头的字符串称为文档字符串，将作为函数的__doc__字段。
1. 所有的函数都返回值，默认是None。

## 参数魔法
1. 参数存储在局部作用域。
1. 关键字参数，使用名称指定参数，可以指定默认值，通常不应结合使用位置参数和关键字参数，除非必不可少的参数很少，而带默认值的可选参数很多。
1. 关键字参数必须在位置参数后面。
1. *收集位置参数为元组，收集参数可以不放在最后，但是后续参数必须是关键字参数，因为\*会收集剩下所有的位置参数。
1. **收集关键字参数为字典。
1. *也可以分配元组、列表作为位置参数，跟收集位置参数相反。
1. **可以分配字典作为关键字参数。

## 作用域
1. 命名空间或作用域的本质是一种不可见的字典。
1. 除全局作用域外，每个函数调用都将创建一个局部作用域。
1. 如果局部变量和全局变量同名，就无法直接访问全局变量，因为局部变量会遮住全局变量。
1. globals会返回全局作用域，locals会返回局部作用域。global运算符可以避免创建同名的局部变量。
1. Python允许函数嵌套，即在函数内部定义函数，这样会导致局部作用域嵌套，内层的局部作用域可以访问外层的局部作用域，这时如果要避免创建内层变量的话，可以用nonlocal运算符实现。

## 递归
1. 递归旨在分解问题，直到满足基线条件。
1. 函数式编程，python提供了map、filter、reduce进行函数式编程，其中map和filter的用途不大，应该用列表推导来替代，至于reduce可以配合lambda表达式。

```Python
import functools

l=[1, 2, 3]
functools.reduce(lambda x, y:x+y, l)
```

# 再谈抽象

## 类
1. object.f()可以视为Class.f(object)的简写，但是后者的多态性更低，因为前者object的类是不确定的，f方法会随object的实际类型而确定，后者的f方法局限于Class类。
1. Python不支持函数重载。
1. __两个下划线开头的字段和方法，在类中可以正常访问，在外部会对名称开头加上一个下划线和类名，模仿私有访问限制。from module import *不会导入以下划线打头的名称。
1. 类的命名空间，类的所有成员都可访问这个命名空间。类定义本质就是执行代码段。

```Python
# 类字段
class C:
    a=1
```

5. Python天然支持多态，并不依赖继承。
1. issubclass确定类是另一个类的子类，\__bases__返回父类信息，isinstance确定对象是类或其子类的实例。
1. Python允许多重继承，前面超类的方法优先于后面的。
1. hasattr判断是否包含属性，包括字段和方法。getattr获得属性，callable判断是否能调用，setattr设置属性，\__dict__查看所有属性。
1. 模块abc提供抽象基类支持，抽象类是不能实例化的类，职责是定义子类应实现的一组抽象方法。ABC.register可以追加抽象基类，但是会破坏抽象基类保证子类实现相应接口的约定。

```Python
from abc import *

class C(ABC):
    @abstractmethod
    def f(self):
        pass
```

# 异常

## 让事情沿你指定的轨道出错
1. 异常机制相比条件判断层次更抽象，使用也更简洁。
1. raise运算符引发异常。

## 捕获异常
1. try except捕捉异常。
1. raise from携带cause的异常。
1. else子句在没有出现异常时才执行。
1. finally子句不管有没有异常都将执行。

## 异常之禅
1. Python中的异常和条件判断在效率性能上差别不多，除非存在性能问题，否则不应在这方面过多考虑优化， 
1. 异常在很多情况下，使用更自然，也更符合Python的风格，应养成尽可能使用异常的习惯。

## 不那么异常的情况
1. 模块warnings中的warn可以发出警告。
1. filterwarnings可以指定针对警告要采取的措施，如error或ignore。
 
# 魔法方法、特性和迭代器

## 构造函数
1. \__init__。
1. \__del__，析构函数，由于无法知道对象被销毁的准确时间，所以尽可能不要使用。
1. 重写构造函数时必须调用超累的构造函数，super().\__init__()。

## 元素访问
1. \__getitem__实现索引查。
1. \__setitem__实现索引改。
1. \__delitem__实现del运算符删。

## 特性
1. property可以抽象读写方法为字段，如果property没有参数表示不可读写，一个参数表示只读，第三个参数是删除字段的方法，第四个参数指定一个文档字符串。
1. @staticmethod静态方法不需要实例或者类作为参数，@classmethod类方法需要将类作为参数，都可以用类名直接调用。
1. \__getattribute__在属性被访问时自动调用，它会拦截对所有属性的访问，因此将拦截__dict__的访问，访问当前实例属性唯一安全的方式是使用超类的__getattribute__方法。
1. \__getattr__在属性被访问而对象没有这样的属性时自动调用。
1. \__setattr__试图给属性赋值时自动调用，实现用__dict__赋值防止无限循环。
1. \__delattr__试图删除属性时自动调用。

## 迭代器
1. \__iter__返回一个迭代器，实现了该方法的对象是可迭代的；\__next__会返回下一个值，如果没有可供返回的值引发StopIteration，实现了该方法的对象是迭代器。
1. 可迭代对象看可以转换为序列。

## 生成器
1. 包含yield语句的函数都被称为生成器，生成器可以生成多个值，每次一个，每次使用yield生成一个值后，函数都将冻结，重新唤醒后，函数将从停止的地方开始继续执行。
1. 没有元组推导，只有生成器推导，在一对既有的圆括号内使用生成器推导时，无需再添加一对圆括号。
1. 生成器由生成器的函数和生成器的迭代器组成，对于生成器的函数返回的迭代器，可以像使用其他迭代器一样使用。
1. send方法可以指定上次yield语句的返回值，并执行一次next。
1. throw方法在表达式yield引发异常，close停止生成器。

# 开箱即用
1. 标准安装包含一组称为标准库的模块。

## 模块
1. 模块就是程序，导入模块时会执行其中的代码，由于模块主要是用来定义变量、函数、类等，而不是用来执行操作的，而定义只需执行一次，所以多次导入模块只会执行第一次，这样也可以避免无限循环导入。
1. importlib模块的reload可以重新导入。
1. python -m progname args将使用命令行参数来执行程序progname。
1. 主程序中，变量__name__的值是'\__main__'，而在导入的模块中，这个变量被设置为该模块的名称，可以用来添加测试代码。 
1. 解释器会在sys.path的路径查找模块，可以临时添加sys.path路径，也可以永久使用.pth路径配置文件。
1. 为组织模块，可将其编组为包，包也是一种模块，如果像普通模块一样导入包，\__init__.py文件的内容就是包的内容。包虽然组织模块，但是导入包模块时并不会顺带导入其他模块。

```Python
import pkg
import pkg.module
from pkg import module
```

## 探索模块
1. dir查看模块所有属性，\__all__查看API，默认import *会导入所有不以下划线打头的属性，而__all__可以自定义API。
1. help获得帮助。
1. \__doc__文档。
1. \__file__使用源代码。

## 标准库：一些深受欢迎的模块
1. sys模块让你能够访问与Python解释器紧密相关的变量和函数。
1. os模块让你能够访问多个操作系统服务。
1. webbrowser模块可以操作浏览器。
1. fileinput模块轻松地迭代文本文件中的所有行。
1. time模块用户获取时间、操作时间以及字符串和时间之间的格式化。
1. random模块提供随机支持，
1. shelve模块提供简单的存储方案。
1. json模块提供json支持。
1. re模块提供正则表达式支持。
1. argparse处理命令行参数，cmd，datetime，difflib确定两个序列的相似程度，enum，functools，hashlib用于加密和安全领域，itertools，logging，statistics，timeit测量代码段执行时间，profile对代码段的效率进行更全面的分析，trace分析代码覆盖率。

**集合、堆和双端队列**
1. 字典的底层是散列表，列表的底层是动态数组。
1. 集合可以用花括号来创建，但是空集合不能，因为空的花括号会创建字典。
1. 集合是可变的，因此不能用作字典中的键。集合只能包含不可变（可散列）的值，类似字典的键也只能是不可变的值。frozenset，表示不可变的集合。
1. 堆是一种优先队列，模块heapq对其提供支持。
1. 双端队列，模块collections对其提供支持。

# 文件

## 打开文件
1. open位于自动导入的模块io中，默认返回可读的文本文件对象。
1. r默认读，w写，x独占写，a附加。写模式会在文件不存在时创建它，独占写模式在文件已存在时引发异常，写模式都会截断文件，附加模式不会截断文件。
1. 可与其他模式结合使用的值，t默认文本，b二进制，+读写。r+不会截断文件，w+会截断文件。
1. 默认模式为rt，这意味着把文件视为经过编码的Unicode文本，因此将自动执行解码和编码，且默认使用平台编码，encoding参数可以指定编码，还将自动转换换行字符。
    * newline控制文本模式的换行，默认值是None，输入可以识别所有的换行符并且会转换成\n，输出\n将转换成系统换行符os.linesep。
    * 如果是空字符串，输入可以识别所有的换行符并且不会转换换行符，输出不会转换换行符。
    * 如果是\n、\r、\r\n，输入只能识别指定换行符并且不会转换换行符，输出\n会转换成指定的换行符。

## 文件的基本方法
1. read, 读入几个字符或者字节.
1. write, 写入字符串或字节串.
1. 文件流只能按顺序从头到尾读取, 而随机存取可以只访问感兴趣的部分, seek可以移动当前位置, tell返回当前位置.
1. readline读入一行, 包括换行符, 也可以限制读取的最大字符数, readlines以列表的方式读取所有行, readlines适用于文件比较小的情况.
1. writelines和readlines相反, 写入时要自行添加换行符.
1. close关闭文件, 可以避免用完系统可能指定的文件打开配额, 对于写如果的文件, Python可能缓冲写入的数据以提高效率, 如果程序崩溃, 数据可能不会写入到文件中, 关闭文件.
1. flush也会将写缓冲刷新到文件中, 根据使用的操作系统和设置, 在写文件时由于锁定可能会禁止其他正在运行的程序访问这个文件.
1. with open(filename) as name会自动关闭文件, 即便出现异常.

## 迭代文件内容
1. 使用fileinput实现延迟行迭代.
1. 最常用的方法是文件迭代器, 文件实际上是可迭代的.

# 图形用户界面

## 创建GUI实例应用程序
1. tkinter内置的GUI.
1. Tk, Button, Label, Entry, ScrolledText.
1. pack布局默认将主窗口作为主控件, 并从窗口顶部居中开始将控件堆叠成一列.
1. 布局管理器还有grid和place, grid可以把控件放在不可见的表格单元格中, place让你能够手工放置控件, 通过help((Pack|Grid|Place).config)了解可用的选项.
1. bind事件处理机制, help(Tk.bind).

# 数据库支持

## Python数据库API
1. 三个全局变量, apilevel, threadsafety, paramstyle.
1. 线程安全程度是一个0到3的整数, 0表示线程不能共享模块, 1表示线程可以共享模块本身, 但不能共享连接, 2表示线程可共享模块和连接, 但不能共享游标, 而3表示模块是绝对线程安全的.
1. connect参数有五个, dsn数据源名称, user, password, host, database; connect返回一个连接对象, 表示当前到数据库的会话, 有四个方法, commit提交事务, rollback回滚未提交的事务, cursor返回连接的游标对象, close关闭后游标也将不可用; commit和rollback需要事务支持, 关闭连接时, 如果还有未提交的事务, 将会自动回滚.
1. cursor游标用来执行SQL查询和查看结果, 方法有callproc调用数据库过程, execute, executemany执行多次SQL操作, fetclone返回查询结果的下一行, fetchmany, fetchall余下的所有行, nextset下一个结果集, setinputsizes, setoutputsize.
1. cursor字段有description由结果列描述组成的序列, rowcount, arraysize是fetchmany的默认行数.
1. 时间戳Timestamp包含时区, 会因为时区的不同而变化, 而DATETIME是绝对值.
1. 类型, Date, Time, Timestamp, DateFromTicks, TimeFromTicks, TimestampFromTicks, Binary.
1. 特殊值, STRING, BINARY, NUMBER, DATETIME, ROWID.

## SQLite和PySQLite
1. SQLite是小型数据库引擎, 不需要作为独立的服务器运行, 可直接使用本地文件, 不需要集中式数据库存储机制.

